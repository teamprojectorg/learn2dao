(()=>{var W=Object.create;var w=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var K=e=>w(e,"__esModule",{value:!0});var ce=typeof require!="undefined"?require:e=>{throw new Error('Dynamic require of "'+e+'" is not supported')};var q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var V=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of D(t))!F.call(e,r)&&r!=="default"&&w(e,r,{get:()=>t[r],enumerable:!(n=U(t,r))||n.enumerable});return e},B=e=>V(K(w(e!=null?W($(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var v=(e,t,n)=>new Promise((r,o)=>{var i=u=>{try{c(n.next(u))}catch(f){o(f)}},s=u=>{try{c(n.throw(u))}catch(f){o(f)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,s);c((n=n.apply(e,t)).next())});var k=q((ue,y)=>{"use strict";var l=typeof Reflect=="object"?Reflect:null,E=l&&typeof l.apply=="function"?l.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},h;l&&typeof l.ownKeys=="function"?h=l.ownKeys:Object.getOwnPropertySymbols?h=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:h=function(t){return Object.getOwnPropertyNames(t)};function H(e){console&&console.warn&&console.warn(e)}var _=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}y.exports=a;y.exports.once=Q;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;var C=10;function m(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return C},set:function(e){if(typeof e!="number"||e<0||_(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");C=e}});a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||_(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function R(e){return e._maxListeners===void 0?a.defaultMaxListeners:e._maxListeners}a.prototype.getMaxListeners=function(){return R(this)};a.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var o=t==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var u=i[t];if(u===void 0)return!1;if(typeof u=="function")E(u,this,n);else for(var f=u.length,d=T(u,f),r=0;r<f;++r)E(d[r],this,n);return!0};function S(e,t,n,r){var o,i,s;if(m(n),i=e._events,i===void 0?(i=e._events=Object.create(null),e._eventsCount=0):(i.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),s===void 0)s=i[t]=n,++e._eventsCount;else if(typeof s=="function"?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),o=R(e),o>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,H(c)}return e}a.prototype.addListener=function(t,n){return S(this,t,n,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(t,n){return S(this,t,n,!0)};function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=G.bind(r);return o.listener=n,r.wrapFn=o,o}a.prototype.once=function(t,n){return m(n),this.on(t,x(this,t,n)),this};a.prototype.prependOnceListener=function(t,n){return m(n),this.prependListener(t,x(this,t,n)),this};a.prototype.removeListener=function(t,n){var r,o,i,s,c;if(m(n),o=this._events,o===void 0)return this;if(r=o[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount==0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){c=r[s].listener,i=s;break}if(i<0)return this;i===0?r.shift():J(r,i),r.length===1&&(o[t]=r[0]),o.removeListener!==void 0&&this.emit("removeListener",t,c||n)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(t){var n,r,o;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var i=Object.keys(r),s;for(o=0;o<i.length;++o)s=i[o],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(t,n[o]);return this};function O(e,t,n){var r=e._events;if(r===void 0)return[];var o=r[t];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?z(o):T(o,o.length)}a.prototype.listeners=function(t){return O(this,t,!0)};a.prototype.rawListeners=function(t){return O(this,t,!1)};a.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):M.call(e,t)};a.prototype.listenerCount=M;function M(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]};function T(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function J(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function z(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Q(e,t){return new Promise(function(n,r){function o(s){e.removeListener(t,i),r(s)}function i(){typeof e.removeListener=="function"&&e.removeListener("error",o),n([].slice.call(arguments))}P(e,t,i,{once:!0}),t!=="error"&&X(e,o,{once:!0})})}function X(e,t,n){typeof e.on=="function"&&P(e,"error",t,n)}function P(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function o(i){r.once&&e.removeEventListener(t,o),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}});var j=B(k()),p=class extends j.EventEmitter{constructor(t){super();this._closeFunc=t}on(t,n){return super.on(t,n)}close(){this._closeFunc()}};function Y(e,t,n,r){return v(this,null,function*(){let o=e?"https":"http",i=n.includes("://")?"rtmp":"streamKey",s=yield fetch(`${o}://${t}/wrtc/offer?${i}=${n}`,{method:"POST",body:JSON.stringify(r),headers:{["content-type"]:"application/json"}});if(s.status!==200)throw new Error(`Error response from server: ${s.status}`);let c=yield s.json();return new RTCSessionDescription(c)})}function Z(e,t,n,r){let o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),i=new p(()=>o.close());return n.getTracks().forEach(c=>o.addTrack(c,n)),o.onicegatheringstatechange=()=>v(this,null,function*(){if(o.iceGatheringState==="complete")try{let c=yield Y(e,t,r,o.localDescription);o.signalingState!=="closed"&&(yield o.setRemoteDescription(c))}catch(c){i.emit("error",c)}}),o.onconnectionstatechange=()=>{switch(o.connectionState){case"connected":i.emit("open");break;case"closed":i.emit("closed");break;case"failed":i.emit("error",new Error("WebRTC connection failed."));break}},(()=>v(this,null,function*(){try{let c=yield o.createOffer();yield o.setLocalDescription(c)}catch(c){i.emit("error",c)}}))(),i}var N=Z;var g=class extends Error{constructor(t,n){super(n);this.code=t}};function b(){let e=["video/webm;codecs=h264","video/webm","video/webm;codecs=opus","video/webm;codecs=vp8","video/webm;codecs=daala","video/mpeg","video/mp4"],t=null;for(let n of e)if(MediaRecorder.isTypeSupported(n)){t=n;break}return t}function ee(e){let t=encodeURIComponent,n=Object.keys(e).filter(r=>!!e[r]).map(r=>t(r)+"="+t(e[r].toString())).join("&");return n.length===0?"":"?"+n}function te(e,t,n,r){let o=e?"wss":"ws",i=n.includes("://")?"rtmp":"streamKey",s=ee({[i]:n,mimeType:r}),c=`${o}://${t}/ws${s}`;return new WebSocket(c)}function A(e,t){oe(e),t.close(1e3)}var ne=2e3;function re(e){e.state!=="recording"&&e.start(ne)}function oe(e){e.state!=="inactive"&&(e.ondataavailable=null,e.stop())}function se(e,t,n,r){if(!window.MediaRecorder)throw new Error("Media Recorder API is not supported in this browser.");let o=b();if(!o)throw new Error("Media Recorder does not support any valid MIME type.");let i=te(e,t,r,o),s=new MediaRecorder(n,{mimeType:o,audioBitsPerSecond:128*1e3,videoBitsPerSecond:3*1024*1024}),c=new p(()=>A(s,i)),u=!1;return s.ondataavailable=function(f){let{data:d}=f;u&&i.send(d)},i.addEventListener("open",()=>{u=!0,re(s),c.emit("open")}),i.addEventListener("close",({code:f,reason:d})=>{u=!1,A(s,i),f!==1e3&&c.emit("error",new g(f,"abnormal websocket closure")),c.emit("close")}),c}var I=se;var L=class{constructor(t={}){let{secure:n=!0,baseUrl:r="origin.livepeer.com/webrtmp",transport:o="ws"}=t;this.secure=n,this.baseUrl=r,this.transport=o}cast(t,n){if(!n)throw new Error("Invalid streamKey.");let{transport:r}=this;if(r==="auto"&&(r=ie()?"ws":"wrtc"),r==="ws")return I(this.secure,this.baseUrl,t,n);if(r==="wrtc")return N(this.secure,this.baseUrl,t,n);throw new Error("Invalid transport; should be either 'ws', 'wrtc' or 'auto'.")}};function ie(){return b().includes("h264")}globalThis.webRTMP={Client:L};})();
